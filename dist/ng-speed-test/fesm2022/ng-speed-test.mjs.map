{"version":3,"file":"ng-speed-test.mjs","sources":["../../../src/models/speed-test-file.model.ts","../../../src/models/speed-test-results.model.ts","../../../src/models/speed-test-settings.model.ts","../../../src/services/speed-test.service.ts","../../../src/speed-test.module.ts","../../../src/ng-speed-test.ts"],"sourcesContent":["export interface SpeedTestFile {\r\n  path: string;\r\n  shouldBustCache: boolean;\r\n  size: number;\r\n}\r\n\r\nexport class SpeedTestFileModel implements SpeedTestFile {\r\n  public path: string = 'https://raw.githubusercontent.com/jrquick17/ng-speed-test/02c59e4afde67c35a5ba74014b91d44b33c0b3fe/demo/src/assets/5mb.jpg';\r\n  public shouldBustCache: boolean = true;\r\n  public size: number = 4952221;\r\n\r\n  constructor(file?: Partial<SpeedTestFile>) {\r\n    if (file) {\r\n      if (file.path !== undefined) {\r\n        this.path = file.path;\r\n      }\r\n      if (file.size !== undefined) {\r\n        this.size = file.size;\r\n      }\r\n      if (file.shouldBustCache !== undefined) {\r\n        this.shouldBustCache = file.shouldBustCache;\r\n      }\r\n    }\r\n  }\r\n}\r\n","export interface SpeedTestResults {\r\n    duration: number;\r\n    hasEnded: boolean;\r\n    startTime: number | null;\r\n    endTime: number | null;\r\n    speedBps: number;\r\n    speedKbps: number;\r\n    speedMbps: number;\r\n}\r\n\r\nexport class SpeedTestResultsModel implements SpeedTestResults {\r\n    public duration: number = 0;\r\n    public hasEnded: boolean = false;\r\n    public startTime: number | null = null;\r\n    public endTime: number | null = null;\r\n    public speedBps: number = 0;\r\n\r\n    constructor(private fileSize: number) {}\r\n\r\n    get speedKbps(): number {\r\n        return this.speedBps / 1024;\r\n    }\r\n\r\n    get speedMbps(): number {\r\n        return this.speedKbps / 1024;\r\n    }\r\n\r\n    private _update(): void {\r\n        if (this.endTime !== null && this.startTime !== null) {\r\n            const milliseconds = this.endTime - this.startTime;\r\n            if (milliseconds !== 0) {\r\n                this.duration = milliseconds / 1000;\r\n            }\r\n            const bitsLoaded = this.fileSize * 8;\r\n            this.speedBps = bitsLoaded / this.duration;\r\n        }\r\n    }\r\n\r\n    end(): void {\r\n        if (!this.hasEnded) {\r\n            this.hasEnded = true;\r\n            this.endTime = Date.now();\r\n            this._update();\r\n        }\r\n    }\r\n\r\n    error(): void {\r\n        if (!this.hasEnded) {\r\n            this.hasEnded = true;\r\n            this.endTime = null;\r\n            this._update();\r\n        }\r\n    }\r\n\r\n    start(): void {\r\n        this.startTime = Date.now();\r\n    }\r\n}\r\n","import {SpeedTestFile, SpeedTestFileModel} from './speed-test-file.model';\r\n\r\nexport interface SpeedTestSettings {\r\n  iterations?: number;\r\n  file?: SpeedTestFile;\r\n  retryDelay?: number;\r\n}\r\n\r\nexport class SpeedTestSettingsModel implements SpeedTestSettings {\r\n  public iterations?: number = 3;\r\n  public file?: SpeedTestFileModel = new SpeedTestFileModel();\r\n  public retryDelay?: number = 500;\r\n\r\n  constructor(settings?: Partial<SpeedTestSettings>) {\r\n    if (settings) {\r\n      if (settings.iterations !== undefined) {\r\n        this.iterations = settings.iterations;\r\n      }\r\n      if (settings.retryDelay !== undefined) {\r\n        this.retryDelay = settings.retryDelay;\r\n      }\r\n      if (settings.file) {\r\n        this.file = new SpeedTestFileModel();\r\n        if (settings.file.path !== undefined) {\r\n          this.file.path = settings.file.path;\r\n        }\r\n        if (settings.file.size !== undefined) {\r\n          this.file.size = settings.file.size;\r\n        }\r\n        if (settings.file.shouldBustCache !== undefined) {\r\n          this.file.shouldBustCache = settings.file.shouldBustCache;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { fromEvent, merge, Observable, of, throwError } from 'rxjs';\r\nimport { map, mergeMap, catchError, timeout, switchMap, startWith } from 'rxjs/operators';\r\n\r\nimport { SpeedTestFileModel } from '../models/speed-test-file.model';\r\nimport { SpeedTestSettingsModel } from '../models/speed-test-settings.model';\r\nimport { SpeedTestResultsModel } from '../models/speed-test-results.model';\r\n\r\nexport interface SpeedTestResult {\r\n    bps: number;\r\n    kbps: number;\r\n    mbps: number;\r\n    duration: number;\r\n}\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class SpeedTestService {\r\n    private readonly DEFAULT_TIMEOUT = 15000; // Reduced from 30s to 15s\r\n    private readonly OFFLINE_CHECK_TIMEOUT = 3000; // Quick offline check\r\n\r\n    constructor() {}\r\n\r\n    private applyCacheBuster(path: string): string {\r\n        const separator = path.includes('?') ? '&' : '?';\r\n        return `${path}${separator}cache_bust=${Date.now()}_${Math.random()}`;\r\n    }\r\n\r\n    /**\r\n     * Quick connectivity check before running speed test\r\n     */\r\n    private checkConnectivity(): Observable<boolean> {\r\n        // First check navigator.onLine\r\n        if (!navigator.onLine) {\r\n            return of(false);\r\n        }\r\n\r\n        // Then do a quick network request to verify actual connectivity\r\n        return new Observable<boolean>(observer => {\r\n            const controller = new AbortController();\r\n            const timeoutId = setTimeout(() => {\r\n                controller.abort();\r\n                observer.next(false);\r\n                observer.complete();\r\n            }, this.OFFLINE_CHECK_TIMEOUT);\r\n\r\n            // Use a small, fast endpoint for connectivity check\r\n            fetch('https://httpbin.org/get?minimal=true', {\r\n                method: 'HEAD',\r\n                mode: 'no-cors',\r\n                signal: controller.signal,\r\n                cache: 'no-cache'\r\n            })\r\n                .then(() => {\r\n                    clearTimeout(timeoutId);\r\n                    observer.next(true);\r\n                    observer.complete();\r\n                })\r\n                .catch(() => {\r\n                    clearTimeout(timeoutId);\r\n                    observer.next(false);\r\n                    observer.complete();\r\n                });\r\n\r\n            return () => {\r\n                clearTimeout(timeoutId);\r\n                controller.abort();\r\n            };\r\n        });\r\n    }\r\n\r\n    private downloadTest(settings: SpeedTestSettingsModel, allResults: SpeedTestResultsModel[] = []): Observable<number> {\r\n        // Quick connectivity check first\r\n        return this.checkConnectivity().pipe(\r\n            switchMap(isConnected => {\r\n                if (!isConnected) {\r\n                    return throwError(() => new Error('No internet connection available'));\r\n                }\r\n\r\n                return new Observable<SpeedTestResultsModel>(observer => {\r\n                    const testResult = new SpeedTestResultsModel(settings.file!.size);\r\n                    const abortController = new AbortController();\r\n\r\n                    let filePath = settings.file!.path;\r\n                    if (settings.file!.shouldBustCache) {\r\n                        filePath = this.applyCacheBuster(filePath);\r\n                    }\r\n\r\n                    testResult.start();\r\n\r\n                    // Set a more aggressive timeout for the fetch request\r\n                    const fetchTimeout = setTimeout(() => {\r\n                        abortController.abort();\r\n                        testResult.error();\r\n                        observer.next(testResult);\r\n                        observer.complete();\r\n                    }, this.DEFAULT_TIMEOUT);\r\n\r\n                    fetch(filePath, {\r\n                        method: 'GET',\r\n                        signal: abortController.signal,\r\n                        cache: 'no-cache'\r\n                    })\r\n                        .then(response => {\r\n                            clearTimeout(fetchTimeout);\r\n                            if (!response.ok) {\r\n                                throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n                            }\r\n                            return response.blob();\r\n                        })\r\n                        .then(() => {\r\n                            testResult.end();\r\n                            observer.next(testResult);\r\n                            observer.complete();\r\n                        })\r\n                        .catch(error => {\r\n                            clearTimeout(fetchTimeout);\r\n                            console.warn('Speed test download failed:', error);\r\n                            testResult.error();\r\n\r\n                            const delay = settings.iterations !== 1 ? settings.retryDelay! : 0;\r\n\r\n                            setTimeout(() => {\r\n                                observer.next(testResult);\r\n                                observer.complete();\r\n                            }, delay);\r\n                        });\r\n\r\n                    // Cleanup function\r\n                    return () => {\r\n                        clearTimeout(fetchTimeout);\r\n                        abortController.abort();\r\n                    };\r\n                });\r\n            }),\r\n            mergeMap((testResult: SpeedTestResultsModel) => {\r\n                allResults.push(testResult);\r\n\r\n                if (settings.iterations === 1) {\r\n                    // Calculate average speed from all valid results\r\n                    const validResults = allResults.filter(result => result.speedBps > 0);\r\n\r\n                    if (validResults.length === 0) {\r\n                        return throwError(() => new Error('All speed test iterations failed - no internet connection or server unreachable'));\r\n                    }\r\n\r\n                    const totalSpeed = validResults.reduce((sum, result) => sum + result.speedBps, 0);\r\n                    const averageSpeed = totalSpeed / validResults.length;\r\n\r\n                    return of(averageSpeed);\r\n                } else {\r\n                    settings.iterations!--;\r\n                    return this.downloadTest(settings, allResults);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    private validateSettings(settings: SpeedTestSettingsModel): void {\r\n        if (!settings.file?.path) {\r\n            throw new Error('ng-speed-test: File path is required');\r\n        }\r\n\r\n        if (!settings.file?.size || settings.file.size <= 0) {\r\n            throw new Error('ng-speed-test: Valid file size is required');\r\n        }\r\n\r\n        if (settings.iterations && settings.iterations < 1) {\r\n            throw new Error('ng-speed-test: Iterations must be at least 1');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get internet speed in bits per second (bps)\r\n     * Fails fast if no internet connection is available\r\n     */\r\n    getBps(customSettings?: Partial<SpeedTestSettingsModel>): Observable<number> {\r\n        return new Observable(observer => {\r\n            // Check connectivity immediately\r\n            if (!navigator.onLine) {\r\n                observer.error(new Error('No internet connection - browser reports offline'));\r\n                return;\r\n            }\r\n\r\n            // Small delay to ensure proper initialization\r\n            setTimeout(() => {\r\n                // Create settings with proper merging\r\n                const defaultSettings = new SpeedTestSettingsModel();\r\n                const settings = this.mergeSettings(defaultSettings, customSettings);\r\n\r\n                try {\r\n                    this.validateSettings(settings);\r\n\r\n                    this.downloadTest(settings).subscribe({\r\n                        next: (speedBps) => {\r\n                            observer.next(speedBps);\r\n                            observer.complete();\r\n                        },\r\n                        error: (error) => {\r\n                            observer.error(error);\r\n                        }\r\n                    });\r\n                } catch (error) {\r\n                    observer.error(error);\r\n                }\r\n            }, 1);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Properly merge custom settings with defaults\r\n     */\r\n    private mergeSettings(defaultSettings: SpeedTestSettingsModel, customSettings?: Partial<SpeedTestSettingsModel>): SpeedTestSettingsModel {\r\n        if (!customSettings) {\r\n            return defaultSettings;\r\n        }\r\n\r\n        const mergedSettings = new SpeedTestSettingsModel();\r\n\r\n        // Merge iterations\r\n        mergedSettings.iterations = customSettings.iterations !== undefined\r\n            ? customSettings.iterations\r\n            : defaultSettings.iterations;\r\n\r\n        // Merge retryDelay\r\n        mergedSettings.retryDelay = customSettings.retryDelay !== undefined\r\n            ? customSettings.retryDelay\r\n            : defaultSettings.retryDelay;\r\n\r\n        // Merge file settings\r\n        if (customSettings.file) {\r\n            mergedSettings.file = new SpeedTestFileModel();\r\n\r\n            // Merge file path\r\n            mergedSettings.file.path = customSettings.file.path !== undefined\r\n                ? customSettings.file.path\r\n                : defaultSettings.file!.path;\r\n\r\n            // Merge file size\r\n            mergedSettings.file.size = customSettings.file.size !== undefined\r\n                ? customSettings.file.size\r\n                : defaultSettings.file!.size;\r\n\r\n            // Merge shouldBustCache\r\n            mergedSettings.file.shouldBustCache = customSettings.file.shouldBustCache !== undefined\r\n                ? customSettings.file.shouldBustCache\r\n                : defaultSettings.file!.shouldBustCache;\r\n        } else {\r\n            mergedSettings.file = defaultSettings.file;\r\n        }\r\n\r\n        return mergedSettings;\r\n    }\r\n\r\n    /**\r\n     * Get internet speed in kilobits per second (Kbps)\r\n     */\r\n    getKbps(settings?: Partial<SpeedTestSettingsModel>): Observable<number> {\r\n        return this.getBps(settings).pipe(\r\n            map(bps => bps / 1024)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get internet speed in megabits per second (Mbps)\r\n     */\r\n    getMbps(settings?: Partial<SpeedTestSettingsModel>): Observable<number> {\r\n        return this.getKbps(settings).pipe(\r\n            map(kbps => kbps / 1024)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get comprehensive speed test results with fast failure for offline scenarios\r\n     */\r\n    getSpeedTestResult(settings?: Partial<SpeedTestSettingsModel>): Observable<SpeedTestResult> {\r\n        const startTime = Date.now();\r\n\r\n        return this.getBps(settings).pipe(\r\n            map(bps => ({\r\n                bps,\r\n                kbps: bps / 1024,\r\n                mbps: bps / (1024 * 1024),\r\n                duration: (Date.now() - startTime) / 1000\r\n            })),\r\n            timeout(this.DEFAULT_TIMEOUT + 5000), // Overall timeout slightly longer than individual request timeout\r\n            catchError(error => {\r\n                if (error.name === 'TimeoutError') {\r\n                    return throwError(() => new Error('Speed test timed out - please check your internet connection'));\r\n                }\r\n                return throwError(() => error);\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Check if the browser is online with enhanced detection\r\n     */\r\n    isOnline(): Observable<boolean> {\r\n        return merge(\r\n            fromEvent(window, 'offline').pipe(map(() => false)),\r\n            fromEvent(window, 'online').pipe(map(() => true)),\r\n            of(navigator.onLine)\r\n        ).pipe(\r\n            startWith(navigator.onLine),\r\n            // Verify actual connectivity for online state\r\n            switchMap(browserOnline => {\r\n                if (!browserOnline) {\r\n                    return of(false);\r\n                }\r\n                // Quick connectivity verification\r\n                return this.checkConnectivity();\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Monitor network connection status with enhanced detection\r\n     */\r\n    getNetworkStatus(): Observable<{ isOnline: boolean; effectiveType?: string; downlink?: number }> {\r\n        const getConnectionInfo = () => {\r\n            const connection = (navigator as any).connection ||\r\n                (navigator as any).mozConnection ||\r\n                (navigator as any).webkitConnection;\r\n\r\n            return {\r\n                isOnline: navigator.onLine,\r\n                effectiveType: connection?.effectiveType,\r\n                downlink: connection?.downlink\r\n            };\r\n        };\r\n\r\n        return merge(\r\n            fromEvent(window, 'offline').pipe(\r\n                map(() => ({ ...getConnectionInfo(), isOnline: false }))\r\n            ),\r\n            fromEvent(window, 'online').pipe(\r\n                map(() => getConnectionInfo()),\r\n                // Verify actual connectivity when browser reports online\r\n                switchMap(info =>\r\n                    this.checkConnectivity().pipe(\r\n                        map(actuallyOnline => ({ ...info, isOnline: actuallyOnline }))\r\n                    )\r\n                )\r\n            ),\r\n            of(getConnectionInfo()).pipe(\r\n                switchMap(info =>\r\n                    info.isOnline\r\n                        ? this.checkConnectivity().pipe(\r\n                            map(actuallyOnline => ({ ...info, isOnline: actuallyOnline }))\r\n                        )\r\n                        : of(info)\r\n                )\r\n            )\r\n        );\r\n    }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { SpeedTestService } from './services/speed-test.service';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule],\r\n  providers: [SpeedTestService]\r\n})\r\nexport class SpeedTestModule {}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}